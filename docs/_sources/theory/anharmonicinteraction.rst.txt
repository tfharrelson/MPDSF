*********************************
Theory: Anharmonic Interactions
*********************************

The theory of anharmonic interactions in the multi-phonon dynamic structure factor starts with the three-phonon matrix elements. These elements couple three phonons together in two distinct ways; one phonon splitting into two others, and two phonons colliding and forming one different phonon. These can be viewed as time reversal pairs. Not just any three-phonon set can form into a matrix element; there are selection rules. The first is that the "crystal" momentum must be conserved before and after the scattering event. The crystal momentum is the actual momentum modulo a reciprocal lattice vector. Therefore, the crystal momentum cannot be larger than half of a reciprocal lattice vector. 

For example, if two phonons participating in a three-phonon scattering process add to a momentum of [0.6, 0.3, 0.3] (in reduced units), then the crystal momentum of the pair is [-0.4, 0.3, 0.3]. This means that the final phonon state must have this momentum.

In the calculation of the phonon lifetimes, Fermi's golden rule is used, and takes the form of:

:math:`\Gamma_{sk}(\omega) = \frac{18}{\pi} \sum_{s's''k'k''}|\phi_{sk, s'k', s''k''}|^2 \Delta(\textbf{k}-\textbf{k}' - \textbf{k}'')\delta(\omega - \omega_{s'k'} - \omega_{s''k''})(n_{sk} + 1)`

in which :math:`\phi` is the third order force constants, :math:`\Gamma` is the phonon decay rate, :math:`\textbf{k}` is the phonon wavevector, :math:`s` is the phonon mode index, :math:`\Delta` is a function that yields 1 if the argument is a reciprocal lattice vector and zero otherwise, and :math:`\omega_{sk}` is the phonon frequency for mode s and wavevector, k. In this equation, we see that the energy of the phonon scattering process need not be explicitly conserved. However, as the phonon decay rate enters as the width of a Lorentzian function, which is strongly peaked near :math:`\omega_{sk}`, it is common to simplify this expression and assume that the energy must be conserved through the scattering process.

In the MPDSF code, the :math:`\Gamma(\omega)` function is used as a broadening function by default. The simplification of enforcing energy conservation can be set by including the ``param_lorentzian`` input directive. This will have little impact if you are interested in either integrating over the frequencies to obtain some other observable, or if you are interested in the shape of the dynamic structure factor near the resonances. However, if you are interested in the shape far away from the resonances (the peaks in frequency space), then parametrized Lorentzian will diverge from the actual :math:`\Gamma` function. This can be important in some dark matter studies. Also, if the default behavior is used, the contribution to the dynamic structure factor from the three-phonon scattering processes falls to zero at energies larger than twice the largest single phonon energy. This is because one phonon cannot convert to a state with an energy larger than any combination of two phonons in a three-phonon process. To go beyond this, secondary three-phonon scattering processes are needed and/or four-phonon scattering processes.
